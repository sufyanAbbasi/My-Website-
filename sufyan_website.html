<!doctype html>
<html lang="en">
<style type="text/css">

	body {
		background-color: #202020;
		font-size: 43px;
		margin-top: 0px;
	}

	.module{
		background-color: #191919;
		position: relative;
		height: calc(95vh);
		width: calc(95vh);
		transform: translateX(-50%);
	  	margin-top: 100px;
	  	left: 50%;
	  	opacity: 0; 
	  	overflow: hidden;
	}

	#first{
		background-color: #202020; 
		margin-top: 0px;
		opacity: 1; 
		overflow: visible;
	}


	#circle-container {

		position: absolute;
		height: 95%;
		margin: auto;
	  	transform: translateY(-50%) translateX(-50%);
	  	top: 50%; 
	  	left: 50%;
	}

	.circle {
		position: relative;
		height: 100%;
		border-radius: 50%; 
	}

	#outer{
		background-color: rgba(0,255,156,.8); 
		border: solid 30px rgba(255,255,255,.95);
	}

	#inner{
		background-color: #202020;
	}

	p {
		color: white;
		position: absolute;
		transform: translateY(-50%) translateX(-50%);
	  	top: 35%; 
	  	left: 50%;
	  	font-size: 2em;
	}

	.header{
		color: white;
		position: absolute;
		transform: translateX(200%);
		overflow:;
		height: 55px;
		width: 100%;
		background-color: rgba(255,255,255,.2);
		text-indent: 5px;
		
	}


</style>

<head>

	<title>Sufyan's Website</title>
	
</head>

<body onload="init()">

<div class = "module" id = "first">
	<div id="circle-container">
		<div class="circle" id="outer">
			
			<div id="circle-container">
				<div class="circle" id="inner"></div>
			</div>
			<p> Welcome! </p>
		</div>
	</div>
</div>



<div class = "module" id = "second">
	<div class = "header">About Me</div> 
</div>

<div class = "module" id = "third">
	<div class = "header">Projects</div> 
</div>

<script type="text/javascript">
	
	function init() {

		$('body').css('font-size', 43 * $(window).height()/725);

		var circleWidth = $('#circle-container').height(); 

		$('.circle').css('width', circleWidth); 

		$(window).on('resize', function(){

			circleWidth = $('#circle-container').height(); 
			$('.circle').css('width', circleWidth); 

			$('body').css('font-size', 43 * $(this).height()/725);

		});
		var degree = 0; 
		var prevScroll = 0; 
		var clockwise = true; 
		var inbound = false;
		var moduleHeight = $('.module').height(); 
		var moduleMargin = 2 * parseInt($('.module').css('margin-top')); 
		var totalIndexes = parseInt($('body').height() / (moduleHeight + moduleMargin));
		var translationX = 200;   
		var opacity = 0; 

		$(window).scroll(function(){
			inbound = false; 
			var currentScroll = $(window).scrollTop(); 
			var currentIndex = parseInt(1.5 * currentScroll / (moduleHeight + moduleMargin)); 
			console.log(currentIndex);
			var isScrollingDown = currentScroll>=prevScroll; 
			var isScrollingUp = currentScroll<= prevScroll; 
			console.log(isScrollingDown,isScrollingUp);

			if (isScrollingDown && currentIndex == 0){
				inbound = true; 
				degree += 1;
				clockwise = true; 
			}else if(isScrollingUp && currentIndex == 0){
				inbound = true; 
				degree -= 1; 
				clockwise = false;
				if (translationX <= 200) translationX += 5; 
				if (opacity >= 0) opacity -= .03; 
				$(".header").css({
									'transform' : 'translateX(' + translationX + '%)',
									'opacity' :  opacity, 
								});  
				$('#second').css('opacity', opacity * 2); 
			}else if (isScrollingDown && currentIndex == 1){
				if (translationX >= 5) translationX -= 5;
				if (translationX < 5) translationX == 0;  
				if (opacity <= 1) opacity += .01; 
				$(".header").css({
									'transform' : 'translateX(' + translationX + '%)',
									'opacity' :  opacity, 
								}); 
				$('#second').css('opacity', opacity * 2); 

			}else if (isScrollingUp && currentIndex == 1){
				if (opacity <= 1) opacity += .05;
				if (opacity > 1) opacity = 1; 
				$('#second').css('opacity', opacity); 
				
			}else if (isScrollingDown && currentIndex == 2){
				if (opacity >= 0) opacity -= .02;
				if (opacity < 0) opacity = 0; 
				$('#second').css('opacity', opacity); 

			}else if (isScrollingUp && currentIndex == 2){
				if (opacity <= 1) opacity += .05;
				if (opacity > 1) opacity = 1; 
				$('#second').css('opacity', opacity); 
				
			}
			console.log(translationX);
			console.log(opacity);
			prevScroll = currentScroll; 
		});


		var pageOpacity = 0; 
		function loop(){
			if (pageOpacity != 1) {
				pageOpacity += .01
				$('body').css("opacity", pageOpacity); 
			};
			if (inbound){
				if(clockwise){
					degree += .5; 
				}else {
					degree -= .5; 
				};
				var jitter = Math.random() - Math.random(); 
				$('#inner').css("transform", "perspective(3000px) rotateZ(" + degree + "deg)"); 
				$('p').css("transform", "translateX(-50%) translateY("+ (-50 + jitter) +"%)");
			}
		
			requestAnimationFrame(loop);
		}

		requestAnimationFrame(loop);
}

</script>

<script type="text/javascript" src="jquery-1.11.1.min.js"></script>

<script type="text/javascript" src="raf.js"></script>

</body>

</html>
